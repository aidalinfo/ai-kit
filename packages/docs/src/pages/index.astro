---
const localeSlugs = ['fr', 'en'];
const defaultLocale = 'fr';
const fallbackPath = `/${defaultLocale}/`;
---
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Redirection…</title>
    <meta name="robots" content="noindex" />
    <meta http-equiv="refresh" content={`0;url=${fallbackPath}`} />
    <script>
      const supportedLocales = new Set({JSON.stringify(localeSlugs)});
      const fallback = {JSON.stringify(defaultLocale)};
      const toPath = (locale) => `/${locale}/`;

      const chooseLocale = () => {
        const candidates = navigator.languages && navigator.languages.length
          ? navigator.languages
          : [navigator.language || navigator.userLanguage];

        for (const raw of candidates) {
          if (!raw) continue;
          const [lang] = raw.toLowerCase().split('-');
          if (supportedLocales.has(lang)) {
            return lang;
          }
        }

        return fallback;
      };

      const target = chooseLocale();
      if (typeof window !== 'undefined') {
        window.location.replace(toPath(target));
      }
    </script>
  </head>
  <body>
    <p>Redirection… Si rien ne se passe, <a href={fallbackPath}>cliquez ici</a>.</p>
  </body>
</html>
