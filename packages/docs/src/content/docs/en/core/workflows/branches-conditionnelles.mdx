---
title: Conditional branches
description: Branch workflow execution dynamically
sidebar:
  order: 4
locale: en-US
---

Workflows can branch using `createConditionStep`. The `.conditions()` method attaches a decision step whose `resolveBranch` function returns either the index of a branch (tuple mode) or an explicit key (object mode). If it returns `undefined`, execution resumes with the next linear step.

```ts
import {
  createConditionStep,
  createStep,
  createWorkflow,
} from "@ai_kit/core";

const calculateScore = createStep<{ score: number }, { score: number }>({
  id: "calculate-score",
  handler: ({ input }) => ({ score: Math.max(0, Math.min(1, input.score)) }),
});

const evaluateRisk = createConditionStep<{ score: number }, { score: number }>({
  id: "evaluate-risk",
  resolveBranch: ({ output }) => {
    if (output.score >= 0.8) return "high";
    if (output.score >= 0.5) return "medium";
    if (output.score >= 0.2) return "low";
    return undefined;
  },
});

const handleLow = createStep<{ score: number }, string>({
  id: "handle-low",
  handler: ({ input }) => `LOW:${input.score}`,
});

const handleMedium = createStep<{ score: number }, string>({
  id: "handle-medium",
  handler: ({ input }) => `MEDIUM:${input.score}`,
});

const handleHigh = createStep<{ score: number }, string>({
  id: "handle-high",
  handler: ({ input }) => `HIGH:${input.score}`,
});

export const riskWorkflow = createWorkflow({ id: "risk" })
  .then(calculateScore)
  .conditions(evaluateRisk)
  .then({
    low: handleLow,
    medium: handleMedium,
    high: handleHigh,
  })
  .commit();
```

Each branch appears in run snapshots (`branchId`, `nextStepId`), and a `step:branch` event is emitted before executing the target step, which improves observability.

## Tuple variant

```ts
createWorkflow({ id: "risk" })
  .then(calculateScore)
  .conditions(
    createConditionStep<{ score: number }, { score: number }>({
      id: "evaluate-risk-index",
      resolveBranch: ({ output }) => (output.score >= 0.5 ? 0 : 1),
    }),
  )
  .then(handleHigh, handleLow)
  .commit();
```

Use this form when order matters more than naming branches (e.g. reusing an array of existing steps).

### Tips

- Make your business rules explicit inside `resolveBranch` to simplify maintenance.
- Emit custom events (`context.emit`) to trace the decision logic.
- Combine `.conditions()` with `createParallelStep` or `createForEachStep` to build hybrid pipelines.

Back to the [introduction page](./) to explore other possibilities.
